import{_ as w,b as x,s as k,f as g,h as l,j as i,w as a,q as h,l as n,o as c,n as F,t as V}from"./index-DfhgN1jK.js";const q={components:{},data(){var s=(m,o,t)=>{o===""?t(new Error("请输入手机号")):t()},e=(m,o,t)=>{o===""?t(new Error("请输入验证码")):t()},u=(m,o,t)=>{o===""?t(new Error("请输入密码")):t()},b=(m,o,t)=>{o===""?t(new Error("请输入新密码")):((o.length<8||o.length>20)&&t(new Error("密码长度不少于8个，不大于20个")),this.userForm.checkPass!==""&&this.activeName=="accound"&&this.$refs.userForm.validateField("checkPass"),this.userForm.checkPass!==""&&this.activeName=="mobile"&&this.$refs.userForm.validateField("checkPass"),t())},r=(m,o,t)=>{o===""&&t(new Error("请再次输入新密码")),o!==this.userForm.password&&t(new Error("两次输入密码不一致!")),t()};return{typeFixed:!1,activeName:"account",userForm:{password:"",checkPass:"",username:"",mobile:"",code:"",email:"",type:"email"},rules:{password:[{required:!0,message:"请输入密码"},{validator:u,trigger:"blur"}],password2:[{required:!0,message:"请输入密码"},{validator:b,trigger:"blur"}],checkPass:[{required:!0,message:"请输入密码"},{validator:r,trigger:"blur"}],email:[{required:!0,message:"请输入邮箱地址",trigger:"blur"},{type:"email",message:"请输入正确的邮箱地址",trigger:["blur","change"]}],mobile:[{required:!0,validator:s,trigger:"blur"}],code:[{required:!0,validator:e,trigger:"blur"}]},code:{time:60,show:!1},interval:null}},methods:{...x({saveUserInfo:"SAVE_USER_INFO"}),typeChange(){this.$refs.userForm.clearValidate(["mobile","email"])},submitForm(){this.$refs.userForm.validate(s=>{if(s){let e={password:this.userForm.password,method:this.userForm.type,key:this.userForm[this.userForm.type],code:this.userForm.code};this.$api.request({url:"/api/users/reset_password/",method:"POST",data:e}).then(u=>{u.code==200?(this.$message({message:u.msg||"重置成功",type:"success"}),this.$router.push("/Login")):this.$message.error(u.data.msg)}).catch(u=>{})}else return!1})},getCode(){let s=this.userForm.type;if(s=="mobile"&&!this.userForm.mobile.length){this.$refs.userForm.validateField("mobile");return}if(s=="email"&&!this.userForm.email.length){this.$refs.userForm.validateField("email");return}this.$api.request({url:"/api/register/send_code/",method:"POST",data:{method:s,key:this.userForm[s]}}).then(e=>{this.code.show=!0,this.interval=setInterval(()=>{this.code.time--,this.code.time<=0&&(clearInterval(this.interval),this.code.show=!1,this.code.time=60)},1e3)})},cancel(){this.$router.go(-1)},saveData(s){k("token",s.data.token),this.saveUserInfo(s.data);try{let e=JSON.parse(this.$utils.getLocalCache("currtSite"));e&&s.data.user.id!=e.userId&&this.$store.commit("setCurrtSite",null)}catch{}}},mounted(){let s=this.$route.query;if(s&&s.invite_type){let e=s&&s.invite_type;this.typeFixed=!0,this.userForm.type=e,this.userForm[e]=s.content||""}}},C={class:"register"},P={class:"left"},E={slot:"append"},S={class:"append-code"},U={key:0,class:"text-gray-600"},I={class:"tc",style:{"margin-top":"20px"}};function N(s,e,u,b,r,m){const o=n("el-tab-pane"),t=n("el-tabs"),f=n("el-input"),p=n("el-form-item"),y=n("el-button"),v=n("el-form"),_=n("el-link");return c(),g("div",C,[e[19]||(e[19]=l("div",{class:"right"},null,-1)),l("div",P,[e[15]||(e[15]=l("h2",{class:"tc",style:{margin:"50px 0px 0px",color:"#666666"}}," EZtCloud ",-1)),e[16]||(e[16]=l("h1",{class:"tc",style:{"margin-bottom":"20px","margin-top":"20px"}},"数据可视化平台",-1)),e[17]||(e[17]=l("h3",{class:"tc",style:{"font-size":"24px","margin-bottom":"40px"}},"重置密码",-1)),i(t,{modelValue:r.userForm.type,"onUpdate:modelValue":e[0]||(e[0]=d=>r.userForm.type=d),style:{margin:"0px 40px 10px"}},{default:a(()=>[i(o,{label:"邮 箱",name:"email"}),i(o,{label:"手机号",name:"mobile"})]),_:1},8,["modelValue"]),i(v,{model:r.userForm,rules:r.rules,ref:"userForm","label-width":"0px",class:"demo-userForm"},{default:a(()=>[r.userForm.type=="mobile"?(c(),F(p,{key:0,label:"",prop:"mobile"},{default:a(()=>[i(f,{type:"number",modelValue:r.userForm.mobile,"onUpdate:modelValue":e[1]||(e[1]=d=>r.userForm.mobile=d),modelModifiers:{trim:!0},clearable:"",disabled:r.typeFixed,placeholder:"请输入手机号",size:"large"},{default:a(()=>e[7]||(e[7]=[l("i",{slot:"prefix",class:"el-input__icon el-icon-mobile"},null,-1)])),_:1},8,["modelValue","disabled"])]),_:1})):(c(),F(p,{key:1,label:"",prop:"email"},{default:a(()=>[i(f,{modelValue:r.userForm.email,"onUpdate:modelValue":e[2]||(e[2]=d=>r.userForm.email=d),modelModifiers:{trim:!0},clearable:"",disabled:r.typeFixed,placeholder:"请输入邮箱",size:"large"},{default:a(()=>e[8]||(e[8]=[l("i",{slot:"prefix",class:"el-input__icon el-icon-message"},null,-1)])),_:1},8,["modelValue","disabled"])]),_:1})),i(p,{label:"",required:"",prop:"password"},{default:a(()=>[i(f,{type:"password",modelValue:r.userForm.password,"onUpdate:modelValue":e[3]||(e[3]=d=>r.userForm.password=d),modelModifiers:{trim:!0},autocomplete:"off","show-password":"",placeholder:"请输入新密码"},{default:a(()=>e[9]||(e[9]=[l("i",{slot:"prefix",class:"el-input__icon el-icon-lock"},null,-1)])),_:1},8,["modelValue"])]),_:1}),i(p,{label:"",required:"",prop:"checkPass"},{default:a(()=>[i(f,{type:"password",modelValue:r.userForm.checkPass,"onUpdate:modelValue":e[4]||(e[4]=d=>r.userForm.checkPass=d),modelModifiers:{trim:!0},autocomplete:"off","show-password":"",placeholder:"请再次输入新密码"},{default:a(()=>e[10]||(e[10]=[l("i",{slot:"prefix",class:"el-input__icon el-icon-lock"},null,-1)])),_:1},8,["modelValue"])]),_:1}),i(p,{label:"",prop:"code"},{default:a(()=>[i(f,{modelValue:r.userForm.code,"onUpdate:modelValue":e[6]||(e[6]=d=>r.userForm.code=d),modelModifiers:{trim:!0},clearable:"",placeholder:"请输入验证码",size:"large"},{default:a(()=>[e[11]||(e[11]=l("i",{slot:"prefix",class:"el-input__icon el-icon-finished"},null,-1)),l("template",E,[l("div",S,[r.code.show?(c(),g("span",U,V(`${r.code.time} s`),1)):(c(),g("span",{key:1,onClick:e[5]||(e[5]=(...d)=>m.getCode&&m.getCode(...d)),class:"text-blue-500 cursor-pointer",style:{cursor:"pointer",padding:"9.5px 0px",display:"inline-block"}},"获取验证码"))])])]),_:1},8,["modelValue"])]),_:1}),i(p,null,{default:a(()=>[i(y,{style:{width:"100%"},type:"primary",onClick:m.submitForm},{default:a(()=>e[12]||(e[12]=[h("重置")])),_:1},8,["onClick"])]),_:1})]),_:1},8,["model","rules"]),l("div",I,[e[14]||(e[14]=h(" 已有账号？ ")),i(_,{href:"/#/Login",type:"primary",style:{"font-size":"16px","vertical-align":"top"}},{default:a(()=>e[13]||(e[13]=[h("直接登陆")])),_:1})]),e[18]||(e[18]=l("div",{class:"reference"},[l("a",{href:"https://beian.miit.gov.cn/",target:"_blank",rel:"noopener noreferrer"},"沪ICP备18022990号-4")],-1))])])}const z=w(q,[["render",N],["__scopeId","data-v-e8c89bbb"]]);export{z as default};
